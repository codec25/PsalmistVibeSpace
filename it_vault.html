<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IT_VAULT // Neural Repository</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon: #00ff41; --bg: #050505; --panel: rgba(10,15,10,0.9);
            --syntax-kw: #ff007f; --syntax-str: #ffcc00;
        }
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--neon); font-family: 'Fira Code', monospace; height: 100vh; overflow: hidden; }
        #matrix-canvas { position: fixed; top: 0; left: 0; z-index: 0; opacity: 0.2; }

        /* --- AUTH SCREEN --- */
        #login-gate {
            position: fixed; inset: 0; z-index: 9999; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(20px);
        }
        .login-box { width: 350px; padding: 40px; border: 1px solid var(--neon); background: #000; text-align: center; }
        .login-input { width: 100%; background: #111; border: 1px solid #333; color: var(--neon); padding: 12px; margin-bottom: 15px; font-family: 'Fira Code'; outline: none; box-sizing: border-box; }
        .btn-access { width: 100%; padding: 12px; background: var(--neon); color: #000; border: none; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; }
        
        /* Decryption Loader */
        #decrypt-loader { display: none; margin-top: 20px; font-size: 0.8rem; letter-spacing: 2px; }

        /* --- MAIN INTERFACE --- */
        #vault-interface { display: none; position: relative; z-index: 10; height: 100vh; flex-direction: column; }
        header { padding: 15px 25px; background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--neon); display: flex; justify-content: space-between; align-items: center; }
        .main-layout { display: grid; grid-template-columns: 280px 1fr 320px; gap: 20px; padding: 20px; flex-grow: 1; overflow: hidden; }
        .panel { background: var(--panel); border: 1px solid var(--neon); padding: 15px; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Editor */
        .editor-container { position: relative; flex-grow: 1; background: #000; border: 1px solid #222; }
        #code-input, #code-highlight { position: absolute; inset: 0; padding: 15px; font-size: 0.9rem; line-height: 1.5; font-family: 'Fira Code'; white-space: pre-wrap; box-sizing: border-box; }
        #code-input { z-index: 2; background: transparent; color: transparent; caret-color: white; border: none; outline: none; resize: none; }
        #code-highlight { z-index: 1; color: #444; pointer-events: none; }
        .token-keyword { color: var(--syntax-kw); } .token-string { color: var(--syntax-str); }

        .btn-ui { background: transparent; border: 1px solid var(--neon); color: var(--neon); padding: 8px 12px; cursor: pointer; font-family: 'Orbitron'; font-size: 0.65rem; }
        #log-feed { flex-grow: 1; overflow-y: auto; font-size: 0.7rem; color: rgba(0,255,65,0.7); background: #000; padding: 10px; border: 1px solid #111; }
    </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div id="login-gate">
    <div class="login-box">
        <h2 style="font-family:'Orbitron';">VAULT_AUTH_v5</h2>
        <input type="text" id="user-id" class="login-input" placeholder="USERNAME">
        <input type="password" id="user-pass" class="login-input" placeholder="PASSWORD">
        <button id="auth-btn" class="btn-access" onclick="handleAuth()">AUTHORIZE</button>
        <div id="decrypt-loader">DECRYPTING: <span id="percent">0%</span></div>
        <p id="error-msg" style="color:red; display:none; font-size:0.7rem; margin-top:10px;"></p>
    </div>
</div>

<div id="vault-interface">
    <header>
        <div style="font-family:'Orbitron';">UNIT: <span id="display-user" style="color:white;">ADMIN</span></div>
        <div id="timer-display" style="color:red; font-size:0.8rem;">SESSION: 05:00</div>
        <button class="btn-ui" onclick="location.reload()">LOCK_SYSTEM</button>
    </header>

    <div class="main-layout">
        <div class="panel">
            <div style="font-size:0.7rem; margin-bottom:10px;">STORAGE_DRIVE</div>
            <div id="snippet-list" style="flex-grow:1; overflow-y:auto;"></div>
            <button class="btn-ui" onclick="clearAll()">PURGE_DRIVE</button>
        </div>

        <div class="panel">
            <div class="editor-container">
                <textarea id="code-input" spellcheck="false" oninput="resetTimer(); updateEditor();"></textarea>
                <pre id="code-highlight"><code></code></pre>
            </div>
            <div style="margin-top:15px; display:flex; gap:10px;">
                <input type="text" id="filename" placeholder="script.js" style="background:#000; border:1px solid #333; color:white; padding:5px; flex-grow:1;">
                <button class="btn-ui" onclick="saveSnippet()">COMMIT</button>
            </div>
        </div>

        <div class="panel">
            <div style="font-size:0.7rem; margin-bottom:10px;">TERMINAL_LOG</div>
            <div id="log-feed"></div>
            <input type="text" id="term-cmd" placeholder="root@vault:~#" style="width:100%; background:#000; border:1px solid var(--neon); color:white; padding:8px; font-size:0.7rem; margin-top:10px;" onkeydown="if(event.key==='Enter') runTerminal(this.value)">
        </div>
    </div>
</div>

<script>
    // --- 1. THE AUTHENTICATION MACHINE ---
    const AuthMachine = {
        state: "IDLE", attempts: 0,
        users: JSON.parse(localStorage.getItem('vault_users')) || { "TEACHER": "admin123", "STUDENT": "study456" },
        
        async verify(u, p) {
            this.state = "VERIFYING";
            if(this.attempts >= 3) return { status: "LOCKED" };
            
            // Artificial delay for "Decryption" feel
            await new Promise(r => setTimeout(r, 2000)); 

            if(this.users[u] && this.users[u] === p) {
                this.state = "GRANTED";
                this.attempts = 0;
                return { status: "SUCCESS" };
            } else {
                this.attempts++;
                this.state = "IDLE";
                return { status: "FAIL", remaining: 3 - this.attempts };
            }
        }
    };

    // --- 2. LOGIN UI LOGIC ---
    async function handleAuth() {
        const u = document.getElementById('user-id').value.toUpperCase();
        const p = document.getElementById('user-pass').value;
        const loader = document.getElementById('decrypt-loader');
        const btn = document.getElementById('auth-btn');
        const err = document.getElementById('error-msg');

        btn.style.display = 'none';
        loader.style.display = 'block';
        
        // Animation
        let pct = 0;
        let iv = setInterval(() => { pct += Math.floor(Math.random()*15); if(pct > 100) pct = 100; document.getElementById('percent').innerText = pct + "%"; }, 150);

        const result = await AuthMachine.verify(u, p);
        clearInterval(iv);

        if(result.status === "SUCCESS") {
            document.getElementById('login-gate').style.display = 'none';
            document.getElementById('vault-interface').style.display = 'flex';
            document.getElementById('display-user').innerText = u;
            startTimer();
            logSystem(`Access Level ${u} Confirmed.`);
        } else {
            loader.style.display = 'none';
            btn.style.display = 'block';
            err.innerText = result.status === "LOCKED" ? "HARDWARE_LOCKOUT_ACTIVE" : `INVALID_KEY (Attempts: ${AuthMachine.attempts}/3)`;
            err.style.display = 'block';
        }
    }

    // --- 3. SESSION & TERMINAL ---
    let sessionTime = 300;
    function startTimer() {
        setInterval(() => {
            sessionTime--;
            let m = Math.floor(sessionTime/60), s = sessionTime%60;
            document.getElementById('timer-display').innerText = `SESSION: ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            if(sessionTime <= 0) location.reload();
        }, 1000);
    }
    function resetTimer() { sessionTime = 300; }

    function runTerminal(val) {
        document.getElementById('term-cmd').value = '';
        logSystem(`> ${val}`);
        if(val === 'help') logSystem("CMDS: help, clear, status, passwd [user]");
        else if(val === 'clear') document.getElementById('log-feed').innerHTML = '';
        else if(val === 'status') logSystem("KERNEL: OPTIMAL\nSTORAGE: LOCAL\nUPLINK: ENCRYPTED");
        else if(val.startsWith('passwd ')) {
            let t = val.split(' ')[1].toUpperCase();
            if(AuthMachine.users[t]) logSystem(`Enter NEW PASS for ${t} in next line... (Simulated)`);
        }
    }

    // --- 4. EDITOR & STORAGE ---
    function updateEditor() {
        let code = document.getElementById('code-input').value;
        code = code.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        code = code.replace(/\b(const|let|var|function|return|if|else)\b/g, '<span class="token-keyword">$1</span>');
        code = code.replace(/(".*?"|'.*?'|`.*?`)/g, '<span class="token-string">$1</span>');
        document.querySelector('#code-highlight code').innerHTML = code + (code.endsWith('\n') ? ' ' : '');
    }

    function saveSnippet() {
        const name = document.getElementById('filename').value || "unnamed.js";
        const code = document.getElementById('code-input').value;
        const snips = JSON.parse(localStorage.getItem('vault_snippets')) || [];
        snips.push({ name, code });
        localStorage.setItem('vault_snippets', JSON.stringify(snips));
        loadList();
        logSystem(`Committed ${name}`);
    }

    function loadList() {
        const list = document.getElementById('snippet-list');
        list.innerHTML = '';
        const snips = JSON.parse(localStorage.getItem('vault_snippets')) || [];
        snips.forEach((s, i) => {
            const d = document.createElement('div');
            d.style = "padding:8px; border-left:2px solid var(--neon); background:rgba(0,255,0,0.05); margin-bottom:5px; cursor:pointer; font-size:0.65rem;";
            d.innerText = s.name;
            d.onclick = () => { document.getElementById('code-input').value = s.code; updateEditor(); };
            list.appendChild(d);
        });
    }

    function logSystem(m) {
        const f = document.getElementById('log-feed');
        f.innerHTML += `<div style="white-space:pre-wrap; margin-bottom:5px;">${m}</div>`;
        f.scrollTop = f.scrollHeight;
    }

    function clearAll() { if(confirm("Purge Storage?")) { localStorage.removeItem('vault_snippets'); loadList(); } }

    // --- MATRIX ---
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const drops = Array(Math.floor(canvas.width/16)).fill(1);
    function draw() {
        ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#0F0'; ctx.font = '16px monospace';
        drops.forEach((y, i) => {
            ctx.fillText(Math.floor(Math.random()*2), i*16, y*16);
            if(y*16 > canvas.height && Math.random() > 0.98) drops[i] = 0;
            drops[i]++;
        });
    }
    setInterval(draw, 40);
    window.onload = loadList;
</script>
</body>
</html>