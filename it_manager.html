<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT_MANAGER // Central Overwatch</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #010204; --panel: rgba(7, 10, 17, 0.98); 
            --blue: #4facfe; --gold: #ffcc00; --border: #1e2544; 
            --green: #00ff88; --red: #ff4b2b; 
        }

        body { 
            margin: 0; background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; 
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #0a1324 0%, #010204 100%);
            padding: 30px; overflow-x: hidden;
        }

        .manager-container { width: 100%; max-width: 1300px; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 25px;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }

        .panel { 
            background: var(--panel); border: 1px solid var(--border); 
            padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
        }

        h3 { font-size: 0.7rem; color: var(--blue); letter-spacing: 3px; margin: 0 0 15px 0; text-transform: uppercase; border-bottom: 1px solid #111; padding-bottom: 10px; }

        /* Terminal Styling */
        .terminal {
            height: 280px; overflow-y: auto; background: #000; border: 1px solid #111;
            padding: 15px; font-family: 'Courier New', monospace; font-size: 0.75rem;
            line-height: 1.4; color: var(--green); margin-bottom: 10px;
            box-shadow: inset 0 0 10px rgba(0,255,136,0.1);
        }

        .term-input-line { display: flex; align-items: center; background: #000; border: 1px solid var(--border); padding: 8px 12px; border-radius: 5px; }
        .term-prompt { color: var(--blue); margin-right: 10px; font-weight: bold; }
        .term-field { flex: 1; background: transparent; border: none; color: #fff; font-family: 'Courier New'; outline: none; }

        /* Buttons */
        .btn {
            padding: 12px; background: transparent; border: 1px solid var(--blue);
            color: var(--blue); font-family: 'Orbitron'; cursor: pointer; border-radius: 8px;
            font-size: 0.6rem; transition: 0.3s; font-weight: 900; margin-top: 5px;
        }
        .btn:hover { background: var(--blue); color: #000; box-shadow: 0 0 15px var(--blue); }
        .btn-red { border-color: var(--red); color: var(--red); }
        .btn-red:hover { background: var(--red); color: #fff; box-shadow: 0 0 15px var(--red); }
        .btn-gold { border-color: var(--gold); color: var(--gold); }
        .btn-gold:hover { background: var(--gold); color: #000; }

        input, textarea {
            width: 100%; background: #000; border: 1px solid var(--border); 
            color: #fff; padding: 10px; font-family: 'Orbitron'; font-size: 0.7rem; border-radius: 5px; margin-bottom: 10px;
        }

        .stat-line { display: flex; justify-content: space-between; font-size: 0.65rem; margin-bottom: 8px; color: #7788aa; }
        .log-sos { color: var(--red); font-weight: 900; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <div class="manager-container">
        <header>
            <div>
                <h1 style="font-size: 1.2rem; letter-spacing: 5px; margin:0;">SYSTEM_OVERWATCH_v6</h1>
                <div id="status-tag" style="font-size: 0.6rem; color: var(--green); margin-top:5px;">ROOT_ACCESS_GRANTED</div>
            </div>
            <button class="btn btn-red" onclick="terminateSession()">TERMINATE_SESSION</button>
        </header>

        <div class="grid">
            <div class="panel">
                <h3>SENSEI_TERMINAL</h3>
                <div class="terminal" id="term-display">
                    <div>-- ROOT_PROVISION_SYSTEM --</div>
                    <div style="color: #555;">Type 'help' for commands</div>
                </div>
                <div class="term-input-line">
                    <span class="term-prompt">></span>
                    <input type="text" id="term-input" class="term-field" placeholder="Enter Command..." onkeydown="handleTerminal(event)">
                </div>
            </div>

            <div class="panel" style="grid-column: span 2;">
                <h3>LIVE_AUDIT_LOG // SYSTEM_PULSE</h3>
                <div class="terminal" id="audit-log" style="height: 335px;"></div>
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="flex:1" onclick="renderLogs()">REFRESH</button>
                    <button class="btn btn-red" style="flex:1" onclick="clearLogs()">WIPE_LOGS</button>
                </div>
            </div>

            <div class="panel">
                <h3>REMOTE_INTERVENTION</h3>
                <button class="btn btn-red" style="width:100%" onclick="toggleSystemLock()">TOGGLE_GLOBAL_LOCK</button>
                <div style="margin-top:15px; border-top: 1px solid #111; padding-top:15px;">
                    <button class="btn btn-gold" style="width:100%" onclick="triggerSFX('horn')">AIR_HORN_BLAST</button>
                    <button class="btn btn-gold" style="width:100%" onclick="triggerSFX('battle')">BATTLE_ALARM</button>
                </div>
            </div>

            <div class="panel">
                <h3>NINJA_INTERDICTION</h3>
                <input type="text" id="target-id" placeholder="NINJA_ID (e.g. USER_123)">
                <button class="btn btn-red" style="width:100%" onclick="freezeUser()">FREEZE_USER</button>
                <button class="btn" style="width:100%" onclick="unfreezeUser()">RESTORE_USER</button>
            </div>

            <div class="panel">
                <h3>NEURAL_BROADCAST</h3>
                <textarea id="broadcast-msg" placeholder="MESSAGE_CONTENT..."></textarea>
                <button class="btn btn-gold" style="width:100%" onclick="sendBroadcast('ALERT')">SEND_ALERT</button>
                <button class="btn btn-red" style="width:100%" onclick="sendBroadcast('CRITICAL')">CRITICAL_OVERRIDE</button>
            </div>
        </div>
    </div>

    <script>
        // Security Gate
        if (localStorage.getItem('it_active') !== 'true') {
            window.location.href = 'index.html';
        }

        const termDisplay = document.getElementById('term-display');

        function writeToTerm(msg, color = 'var(--green)') {
            termDisplay.innerHTML += `<div style="color:${color}">${msg}</div>`;
            termDisplay.scrollTop = termDisplay.scrollHeight;
        }

        // Terminal Logic
        function handleTerminal(e) {
            if (e.key === 'Enter') {
                const input = e.target.value.trim();
                e.target.value = "";
                if (!input) return;

                writeToTerm(`admin@root:~$ ${input}`, '#fff');
                const parts = input.split(' ');
                const cmd = parts[0].toLowerCase();

                let vault = JSON.parse(localStorage.getItem('vault_users')) || { teachers: {} };

                switch(cmd) {
                    case 'help':
                        writeToTerm("COMMANDS: provision [id] [pass], list, clear, revoke [id]");
                        break;
                    case 'clear':
                        termDisplay.innerHTML = "";
                        break;
                    case 'list':
                        const teachers = vault.teachers || {};
                        Object.keys(teachers).forEach(t => writeToTerm(`> SENSEI: ${t}`));
                        break;
                    case 'provision':
                        if(parts.length < 3) return writeToTerm("ERROR: [ID] [PASS] REQ", 'var(--red)');
                        vault.teachers[parts[1].toUpperCase()] = parts[2];
                        localStorage.setItem('vault_users', JSON.stringify(vault));
                        writeToTerm(`SUCCESS: ${parts[1]} PROVISIONED`, 'var(--gold)');
                        logAction(`NEW_SENSEI_CREATED: ${parts[1]}`);
                        break;
                    case 'revoke':
                        delete vault.teachers[parts[1].toUpperCase()];
                        localStorage.setItem('vault_users', JSON.stringify(vault));
                        writeToTerm(`REVOKED: ${parts[1]}`, 'var(--red)');
                        break;
                    default:
                        writeToTerm("UNKNOWN COMMAND", 'var(--red)');
                }
            }
        }

        // Action Logic
        function toggleSystemLock() {
            const current = localStorage.getItem('global_system_lock') === 'true';
            localStorage.setItem('global_system_lock', !current);
            logAction(`SYSTEM_LOCK: ${!current ? 'ENGAGED' : 'DISENGAGED'}`);
        }

        function triggerSFX(type) {
            localStorage.setItem('sfx_trigger', type);
            logAction(`REMOTE_SFX: ${type.toUpperCase()}`);
        }

        function freezeUser() {
            const id = document.getElementById('target-id').value.trim().toUpperCase();
            if(!id) return;
            localStorage.setItem(`freeze_${id}`, 'true');
            logAction(`USER_FROZEN: ${id}`);
        }

        function unfreezeUser() {
            const id = document.getElementById('target-id').value.trim().toUpperCase();
            if(!id) return;
            localStorage.removeItem(`freeze_${id}`);
            logAction(`USER_UNFROZEN: ${id}`);
        }

        function sendBroadcast(type) {
            const msg = document.getElementById('broadcast-msg').value;
            if(!msg) return;
            localStorage.setItem('system_broadcast', JSON.stringify({ message: msg, type: type, timestamp: Date.now() }));
            logAction(`BROADCAST: ${type}`);
            document.getElementById('broadcast-msg').value = "";
        }

        function logAction(status) {
            let db = JSON.parse(localStorage.getItem('vault_users')) || { AUDIT_LOG: [] };
            db.AUDIT_LOG = db.AUDIT_LOG || [];
            db.AUDIT_LOG.unshift({ time: new Date().toLocaleTimeString(), user: "ROOT", status: status });
            localStorage.setItem('vault_users', JSON.stringify(db));
            renderLogs();
        }

        function renderLogs() {
            const logContainer = document.getElementById('audit-log');
            const db = JSON.parse(localStorage.getItem('vault_users')) || { AUDIT_LOG: [] };
            
            // Catch SOS from index.html
            const sos = JSON.parse(localStorage.getItem('system_broadcast'));
            if(sos && sos.message.includes("SOS:")) {
                const alreadyLogged = db.AUDIT_LOG.some(l => l.status.includes(sos.message));
                if(!alreadyLogged) {
                    db.AUDIT_LOG.unshift({ time: new Date().toLocaleTimeString(), user: "SYSTEM", status: `<span class="log-sos">${sos.message}</span>` });
                    localStorage.setItem('vault_users', JSON.stringify(db));
                }
            }

            logContainer.innerHTML = (db.AUDIT_LOG || []).map(entry => `
                <div style="margin-bottom:8px; border-bottom:1px solid #111; padding-bottom:4px; font-size:0.7rem;">
                    <span style="color:#444;">[${entry.time}]</span> 
                    <span style="color:var(--blue); font-weight:bold;">${entry.user}</span>: ${entry.status}
                </div>
            `).join('');
        }

        function terminateSession() {
            localStorage.removeItem('it_active');
            window.location.href = 'index.html';
        }

        function clearLogs() {
            let db = JSON.parse(localStorage.getItem('vault_users')) || {};
            db.AUDIT_LOG = [];
            localStorage.setItem('vault_users', JSON.stringify(db));
            renderLogs();
        }

        setInterval(renderLogs, 3000);
        window.onload = renderLogs;
    </script>
</body>
</html>
