<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PSALMIST VIBES // NINJA_PORTAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #010204; 
            --panel: rgba(7, 10, 17, 0.98); 
            --blue: #4facfe; 
            --gold: #ffcc00; 
            --border: #1e2544; 
            --green: #00ff88; 
            --red: #ff4b2b; 
        }

        * { box-sizing: border-box; outline: none; }

        body { 
            margin: 0; background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #0a1324 0%, #010204 100%);
            overflow: hidden;
        }

        /* --- Musical Background Aesthetics --- */
        .staff-line { position: fixed; left: 0; width: 100%; height: 1px; background: rgba(255,255,255,0.03); z-index: -1; pointer-events: none; }
        
        .floating-note {
            position: absolute; color: rgba(0, 255, 136, 0.1); font-size: 2rem;
            animation: floatUp 10s linear infinite; pointer-events: none; z-index: -1;
        }

        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            50% { opacity: 0.2; }
            100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
        }

        .portal-card {
            width: 420px; padding: 60px 40px; background: var(--panel);
            border: 1px solid var(--border); border-radius: 40px;
            box-shadow: 0 0 60px rgba(0,0,0,0.9), inset 0 0 30px rgba(0, 255, 136, 0.05);
            text-align: center; position: relative; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
        }

        .musical-header { font-size: 1.5rem; color: var(--gold); margin-bottom: 10px; letter-spacing: 15px; opacity: 0.8; }

        .portal-card::before {
            content: "PSALMIST VIBES"; position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            background: var(--bg); padding: 5px 20px; color: var(--gold); font-size: 0.7rem; 
            letter-spacing: 5px; border: 1px solid var(--border); border-radius: 10px;
        }

        h2 { font-size: 1.1rem; letter-spacing: 8px; margin-bottom: 40px; color: var(--green); transition: 0.4s; }

        .input-group { margin-bottom: 20px; }
        
        input {
            width: 100%; padding: 18px; background: rgba(0,0,0,0.8); border: 1px solid var(--border);
            color: #fff; border-radius: 15px; font-family: 'Orbitron'; text-align: center;
            font-size: 0.85rem; transition: 0.3s;
        }

        input:focus { border-color: var(--green); box-shadow: 0 0 15px rgba(0, 255, 136, 0.2); }

        .btn {
            width: 100%; padding: 20px; border: none; border-radius: 15px; font-family: 'Orbitron';
            font-weight: 900; cursor: pointer; transition: 0.4s; text-transform: uppercase;
            letter-spacing: 4px; margin-top: 15px;
        }

        .btn-main { background: var(--green); color: #000; box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2); }
        .btn-main:hover { background: #fff; transform: scale(1.02); }

        .sub-links { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; }
        
        .link { 
            color: #444; font-size: 0.6rem; text-decoration: none; cursor: pointer; 
            letter-spacing: 2px; transition: 0.3s; text-transform: uppercase;
        }
        .link:hover { color: var(--gold); }
        .link.sensei-toggle { color: #2a3a5a; font-weight: bold; padding: 10px; border: 1px solid #111; border-radius: 10px; }
        .link.sensei-toggle:hover { color: var(--blue); border-color: var(--blue); }

        #err-log { color: var(--red); font-size: 0.65rem; margin-top: 20px; display: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="staff-line" style="top: 20%"></div><div class="staff-line" style="top: 40%"></div>
    <div class="staff-line" style="top: 60%"></div><div class="staff-line" style="top: 80%"></div>

    <div class="portal-card" id="card">
        <div class="musical-header">♩ ♪ ♫ ♬</div>
        <h2 id="portal-title">NINJA_PORTAL</h2>
        
        <div class="input-group">
            <input type="text" id="u-id" placeholder="NINJA_ID_CODE" autocomplete="off">
        </div>
        <div class="input-group">
            <input type="password" id="u-pass" placeholder="SECURITY_KEY">
        </div>

        <button class="btn btn-main" id="main-btn" onclick="executeAuth()">INITIALIZE</button>

        <div class="sub-links">
            <a class="link" onclick="launchGuest()">CONTINUE_AS_GUEST</a>
            <a class="link sensei-toggle" id="mode-toggle" onclick="toggleSenseiMode()">ARE YOU A SENSEI?</a>
        </div>

        <div id="err-log">FREQUENCY_MISMATCH: ACCESS_DENIED</div>
    </div>

    <script>
        let isSenseiMode = false;

        // --- 1. MUSICAL AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playNote(freq) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        }

        // --- 2. GLOBAL LISTENERS ---
        document.addEventListener('keydown', (e) => {
            // Play note on typing
            if (e.target.tagName === 'INPUT') playNote(220 + (Math.random() * 440));
            
            // Trigger Initialize on Enter
            if (e.key === 'Enter') executeAuth();

            // Secret IT Handshake (Ctrl + Shift + I)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                window.location.href = 'it_manager.html';
            }
        });

        // --- 3. MODE TOGGLE (Ninja vs Sensei) ---
        function toggleSenseiMode() {
            isSenseiMode = !isSenseiMode;
            const card = document.getElementById('card');
            const title = document.getElementById('portal-title');
            const btn = document.getElementById('main-btn');
            const toggle = document.getElementById('mode-toggle');

            if (isSenseiMode) {
                title.innerText = "SENSEI_VAULT";
                title.style.color = "var(--blue)";
                btn.style.background = "var(--blue)";
                btn.innerText = "DECRYPT_SENSEI";
                toggle.innerText = "RETURN_TO_NINJA_PORTAL";
                card.style.borderColor = "var(--blue)";
            } else {
                title.innerText = "NINJA_PORTAL";
                title.style.color = "var(--green)";
                btn.style.background = "var(--green)";
                btn.innerText = "INITIALIZE";
                toggle.innerText = "ARE YOU A SENSEI?";
                card.style.borderColor = "var(--border)";
            }
        }

        // --- 4. AUTHENTICATION LOGIC ---
        function executeAuth() {
            const id = document.getElementById('u-id').value.trim().toUpperCase();
            const pass = document.getElementById('u-pass').value.trim();
            
            // Master Admin Backdoor
            if (id === "ROOT" && pass === "GOD_MODE_99") {
                window.location.href = 'it_recovery.html';
                return;
            }

            if (isSenseiMode) {
                const db = JSON.parse(localStorage.getItem('psalmist_teachers')) || {};
                if (db[id] && db[id].password === pass) {
                    sessionStorage.setItem('currentTeacher', id);
                    window.location.href = 'teacher_dashboard.html';
                } else { showError(); }
            } else {
                const storedPass = localStorage.getItem(`pass_${id}`);
                const isLocked = localStorage.getItem(`lock_${id}`) === "true";

                if (isLocked) {
                    alert("ACCOUNT_LOCKED_BY_SENSEI");
                    return;
                }

                if (storedPass === pass && pass !== "") {
                    localStorage.setItem('ninjaUser', id);
                    window.location.href = 'hub.html';
                } else { showError(); }
            }
        }

        function launchGuest() {
            const guestID = "GUEST_" + Math.floor(Math.random() * 999);
            localStorage.setItem('ninjaUser', guestID);
            localStorage.setItem('isGuest', 'true');
            window.location.href = 'hub.html';
        }

        function showError() {
            const err = document.getElementById('err-log');
            err.style.display = "block";
            setTimeout(() => { err.style.display = "none"; }, 3000);
        }

        // --- 5. VISUAL EFFECTS ---
        setInterval(() => {
            const notes = ['♩', '♪', '♫', '♬'];
            const n = document.createElement('div');
            n.className = 'floating-note';
            n.innerText = notes[Math.floor(Math.random() * notes.length)];
            n.style.left = Math.random() * 100 + "vw";
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 10000);
        }, 3000);
    </script>
</body>
</html>
