<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENSEI_DASH // Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #010204; --panel: rgba(7, 10, 17, 0.98); 
            --blue: #4facfe; --gold: #ffcc00; --border: #1e2544; 
            --green: #00ff88; --red: #ff4b2b; --purple: #a18cd1;
        }

        body { 
            margin: 0; background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; 
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #0a1324 0%, #010204 100%);
            padding: 20px; overflow-x: hidden;
        }

        .dash-container { width: 100%; max-width: 1400px; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 30px;
        }

        .it-status { display: flex; align-items: center; gap: 10px; font-size: 0.6rem; color: #555; }
        .light { width: 10px; height: 10px; border-radius: 50%; background: #222; transition: 0.3s; }
        .light.watching { background: var(--red); box-shadow: 0 0 10px var(--red); }

        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .panel { 
            background: var(--panel); border: 1px solid var(--border); 
            padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h3 { font-size: 0.7rem; color: var(--blue); letter-spacing: 3px; margin-top: 0; text-transform: uppercase; border-bottom: 1px solid #111; padding-bottom: 10px; margin-bottom: 15px; }

        input, select, textarea {
            width: 100%; background: #000; border: 1px solid var(--border); 
            color: #fff; padding: 10px; font-family: 'Orbitron'; font-size: 0.7rem; margin-bottom: 10px; border-radius: 8px;
        }

        .btn {
            width: 100%; padding: 12px; background: transparent; border: 1px solid var(--blue);
            color: var(--blue); font-family: 'Orbitron'; cursor: pointer; border-radius: 8px;
            font-size: 0.6rem; transition: 0.3s; font-weight: 900; letter-spacing: 1px;
            text-transform: uppercase;
        }
        .btn:hover { background: var(--blue); color: #000; box-shadow: 0 0 10px var(--blue); }
        .btn-red { border-color: var(--red); color: var(--red); }
        .btn-red:hover { background: var(--red); color: #fff; box-shadow: 0 0 10px var(--red); }
        .btn-green { border-color: var(--green); color: var(--green); }
        .btn-green:hover { background: var(--green); color: #000; box-shadow: 0 0 10px var(--green); }
        .btn-gold { border-color: var(--gold); color: var(--gold); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        .bracket-slot { width: 150px; background: #000; border: 1px solid var(--border); color: #fff; font-size: 0.6rem; padding: 8px; margin-bottom: 5px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="dash-container">
    <header>
        <div>
            <h1 style="font-size: 1.2rem; letter-spacing: 5px; margin:0;">SENSEI_DASH // CLASSROOM_CORE</h1>
            <div class="it-status">
                <div id="it-light" class="light"></div>
                <span id="it-text">IT_SURVEILLANCE: PASSIVE</span>
            </div>
        </div>
        <button class="btn btn-red" style="width:auto; padding: 10px 25px;" onclick="location.href='index.html'">EXIT_COMMAND</button>
    </header>

    <div class="grid">
        <div class="panel">
            <h3>DEPLOY_MISSION</h3>
            <input type="text" id="m-name" placeholder="MISSION_CODENAME">
            <input type="number" id="m-goal" placeholder="XP_GOAL">
            <select id="m-type">
                <option value="PITCH_HUB">PITCH_HUB</option>
                <option value="PIANO_LAB">PIANO_LAB</option>
                <option value="RHYTHM_HUB">RHYTHM_HUB</option>
            </select>
            <button class="btn btn-blue" onclick="deployMission()">TRANSMIT_ORDERS</button>
            <button class="btn btn-red" style="margin-top:5px;" onclick="cancelMission()">ABORT_MISSION</button>
        </div>

        <div class="panel">
            <h3>NINJA_ROSTER_OVERWATCH</h3>
            <div id="leaderboard-list" style="height: 250px; overflow-y: auto; background: #000; padding: 10px; border-radius: 8px; border: 1px solid #111;"></div>
            <div id="total-xp-pool" style="font-size:0.55rem; color:var(--gold); margin-top:10px; text-align:right;">TOTAL_POWER: 0</div>
        </div>

        <div class="panel">
            <h3>ENROLLMENT_OFFICE</h3>
            <input type="text" id="new-ninja-id" placeholder="NEW_STUDENT_ID">
            <input type="password" id="new-ninja-pass" placeholder="SET_TEMP_PASSWORD">
            <button class="btn btn-green" onclick="enrollNinja()">ENROLL_STUDENT</button>
            
            <hr style="border:0; border-top:1px solid #111; margin: 20px 0;">
            
            <h3>CLASS_BROADCAST</h3>
            <textarea id="announcement-input" placeholder="SEND MESSAGE TO ALL HUBS..."></textarea>
            <button class="btn btn-blue" onclick="postAnnouncement()">BROADCAST_NOW</button>
        </div>

        <div class="panel" style="grid-column: span 2;">
            <h3>DUEL_ARENA_CONTROLS</h3>
            <div style="display:flex; justify-content:space-around; align-items:center; background:#000; padding:20px; border-radius:10px; border: 1px solid #111;">
                <div style="text-align:center; width: 45%;">
                    <select id="select-n1" onchange="updateDuel()"></select>
                    <div id="stat-n1" style="font-size:1.8rem; color:var(--blue); font-weight:900;">0 XP</div>
                </div>
                <div style="font-size:1.5rem; color:var(--red); font-weight:900; text-shadow: 0 0 10px var(--red);">VS</div>
                <div style="text-align:center; width: 45%;">
                    <select id="select-n2" onchange="updateDuel()"></select>
                    <div id="stat-n2" style="font-size:1.8rem; color:var(--gold); font-weight:900;">0 XP</div>
                </div>
            </div>
            <button class="btn btn-purple" style="margin-top:10px; border-color:var(--purple); color:var(--purple);" onclick="announceWinner()">DECLARE_WINNER</button>
        </div>

        <div class="panel">
            <h3>SESSION_TIMER</h3>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <input type="number" id="timer-input" value="60" style="margin:0;">
                <button class="btn btn-green" style="width:auto;" onclick="startTimer()">START</button>
            </div>
            <div id="dash-timer-preview" style="text-align:center; font-size:2rem; color:var(--gold); margin-bottom:10px; font-weight:900; text-shadow: 0 0 15px var(--gold);">00:00</div>
            <div style="display:flex; gap:5px;">
                <button class="btn btn-gold" onclick="fireSFX('horn')">ðŸ”” BELL</button>
                <button class="btn btn-red" onclick="fireSFX('battle')">ðŸ’¥ CRASH</button>
            </div>
        </div>

        <div class="panel" style="grid-column: span 3;">
            <h3>TOURNAMENT_BRACKET_ENGINE</h3>
            <div style="display:flex; justify-content:space-between; padding:30px; background:#000; border-radius:12px; border: 1px solid #111;">
                <div style="display:flex; flex-direction:column; justify-content:center; gap:10px;">
                    <input type="text" class="bracket-slot" id="q1" placeholder="QUALIFIER_1">
                    <input type="text" class="bracket-slot" id="q2" placeholder="QUALIFIER_2">
                    <div style="height:20px;"></div>
                    <input type="text" class="bracket-slot" id="q3" placeholder="QUALIFIER_3">
                    <input type="text" class="bracket-slot" id="q4" placeholder="QUALIFIER_4">
                </div>
                <div style="display:flex; flex-direction:column; justify-content:center; gap:60px;">
                    <input type="text" class="bracket-slot" id="s1" placeholder="SEMI_FINAL_1" style="border-color:var(--purple);">
                    <input type="text" class="bracket-slot" id="s2" placeholder="SEMI_FINAL_2" style="border-color:var(--purple);">
                </div>
                <div style="display:flex; flex-direction:column; justify-content:center;">
                    <div style="font-size:0.5rem; color:var(--gold); text-align:center; margin-bottom:5px;">GRAND_CHAMPION</div>
                    <input type="text" class="bracket-slot" id="f1" placeholder="WINNER" style="border-color:var(--gold); height:50px; text-align:center; font-size:0.8rem; font-weight:900;">
                </div>
            </div>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn btn-gold" style="width:auto;" onclick="saveBracket()">SAVE_STATE</button>
                <button class="btn btn-red" style="width:auto;" onclick="resetBracket()">PURGE_BRACKET</button>
            </div>
        </div>
    </div>
</div>

<script>
    const SENSEI_ID = localStorage.getItem('ninjaUser') || "SENSEI";
    let tInt;

    // --- SYSTEM SYNC ---
    function checkITStatus() {
        const isWatched = localStorage.getItem('it_active') === 'true';
        document.getElementById('it-light').className = isWatched ? 'light watching' : 'light';
        document.getElementById('it-text').innerText = isWatched ? "IT_SURVEILLANCE: ACTIVE" : "IT_SURVEILLANCE: PASSIVE";
    }

    // --- STUDENT ENROLLMENT ---
    function enrollNinja() {
        const id = document.getElementById('new-ninja-id').value.trim().toUpperCase();
        const pass = document.getElementById('new-ninja-pass').value.trim();
        if (!id || !pass) return alert("REQUIRED: ID & PASS");

        let roster = JSON.parse(localStorage.getItem('ninja_roster_full')) || {};
        if (!roster[id]) {
            roster[id] = { 
                pass: pass, 
                xp: 0, 
                status: "LEVEL 01 ACADEMY",
                joined: new Date().toLocaleDateString()
            };
            localStorage.setItem('ninja_roster_full', JSON.stringify(roster));
            
            document.getElementById('new-ninja-id').value = "";
            document.getElementById('new-ninja-pass').value = "";
            refreshUI();
            alert("SUCCESS: NINJA " + id + " ENROLLED.");
        } else {
            alert("ERROR: ID ALREADY EXISTS.");
        }
    }

    // --- REFRESH INTERFACE ---
    function refreshUI() {
        const list = document.getElementById('leaderboard-list');
        const roster = JSON.parse(localStorage.getItem('ninja_roster_full')) || {};
        const ids = Object.keys(roster);
        let totalXP = 0;

        if (ids.length === 0) {
            list.innerHTML = "<div style='color:#333; text-align:center; margin-top:100px;'>NO_STUDENTS_DETECTED</div>";
            return;
        }

        // Generate Leaderboard
        const sorted = ids.map(id => ({ id, ...roster[id] })).sort((a,b) => b.xp - a.xp);
        
        list.innerHTML = sorted.map((n, i) => {
            totalXP += n.xp;
            const isElite = ["ELITE_STRIKER", "SHADOW_MASTER"].includes(n.status);
            const rowStyle = isElite ? 'border: 1px solid var(--blue); background: rgba(79,172,254,0.05);' : 'border-bottom: 1px solid #111;';
            const badge = isElite ? `<span style="color:var(--blue); font-size:0.5rem;">[${n.status}]</span>` : '';

            return `
                <div style="padding:10px; margin-bottom:5px; border-radius:8px; ${rowStyle}">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:0.65rem;">#${i+1} ${n.id} ${badge}</span>
                        <span style="color:var(--green); font-size:0.7rem; font-weight:900;">${n.xp.toLocaleString()} XP</span>
                    </div>
                    <div style="display:flex; gap:5px; margin-top:10px;">
                        <button class="btn" style="padding:5px; font-size:0.4rem;" onclick="modifyXP('${n.id}', 100)">+100</button>
                        <button class="btn" style="padding:5px; font-size:0.4rem;" onclick="modifyXP('${n.id}', 500)">+500</button>
                        <button class="btn btn-red" style="padding:5px; font-size:0.4rem;" onclick="modifyXP('${n.id}', -500)">-500</button>
                    </div>
                </div>`;
        }).join('');

        document.getElementById('total-xp-pool').innerText = `TOTAL_POWER: ${totalXP.toLocaleString()}`;
        
        // Populate Duel Selects
        const s1 = document.getElementById('select-n1'), s2 = document.getElementById('select-n2');
        const oldS1 = s1.value, oldS2 = s2.value;
        const opts = ids.map(id => `<option value="${id}">${id}</option>`).join('');
        s1.innerHTML = opts; s2.innerHTML = opts;
        if(oldS1) s1.value = oldS1; if(oldS2) s2.value = oldS2;
        updateDuel();
    }

    function modifyXP(id, amt) {
        let roster = JSON.parse(localStorage.getItem('ninja_roster_full')) || {};
        if (roster[id]) {
            roster[id].xp = Math.max(0, (roster[id].xp || 0) + amt);
            localStorage.setItem('ninja_roster_full', JSON.stringify(roster));
            refreshUI();
        }
    }

    // --- DUEL ARENA ---
    function updateDuel() {
        const roster = JSON.parse(localStorage.getItem('ninja_roster_full')) || {};
        const n1 = document.getElementById('select-n1').value;
        const n2 = document.getElementById('select-n2').value;
        if(n1) document.getElementById('stat-n1').innerText = (roster[n1].xp || 0).toLocaleString() + " XP";
        if(n2) document.getElementById('stat-n2').innerText = (roster[n2].xp || 0).toLocaleString() + " XP";
    }

    function announceWinner() {
        const winner = document.getElementById('select-n1').value;
        postAnnouncement(`VICTORY: ${winner} HAS WON THE DUEL!`);
        fireSFX('horn');
    }

    // --- TIMER & SFX ---
    function startTimer() {
        let s = parseInt(document.getElementById('timer-input').value);
        clearInterval(tInt);
        tInt = setInterval(() => {
            s--;
            let str = Math.floor(s/60).toString().padStart(2,'0') + ":" + (s%60).toString().padStart(2,'0');
            localStorage.setItem('active_timer', JSON.stringify({ active: true, timeString: str }));
            document.getElementById('dash-timer-preview').innerText = str;
            if (s<=0) { 
                clearInterval(tInt); 
                fireSFX('battle'); 
                localStorage.setItem('active_timer', JSON.stringify({ active: false })); 
            }
        }, 1000);
    }

    function fireSFX(type) { 
        localStorage.setItem('sfx_trigger', type); 
        setTimeout(() => localStorage.removeItem('sfx_trigger'), 1000); 
    }

    // --- TOURNAMENT & MISSIONS ---
    function deployMission() {
        const name = document.getElementById('m-name').value;
        const goal = document.getElementById('m-goal').value;
        const type = document.getElementById('m-type').value;
        if(!name || !goal) return alert("MISSION_DATA_MISSING");
        localStorage.setItem('active_mission', JSON.stringify({ name, goal, type, active: true }));
        alert("TRANSMISSION_COMPLETE: MISSION LIVE.");
    }

    function cancelMission() { localStorage.removeItem('active_mission'); alert("MISSION_ABORTED."); }

    function postAnnouncement() {
        const msg = document.getElementById('announcement-input').value;
        if(!msg) return;
        localStorage.setItem('system_broadcast', JSON.stringify({ message: msg, type: 'ALERT', timestamp: Date.now() }));
        document.getElementById('announcement-input').value = "";
        alert("BROADCAST_SENT");
    }

    function saveBracket() {
        const b = {};
        ['q1','q2','q3','q4','s1','s2','f1'].forEach(id => b[id] = document.getElementById(id).value);
        localStorage.setItem('tournament_bracket', JSON.stringify(b));
        alert("STATE_SAVED");
    }

    function resetBracket() {
        if(confirm("WIPE_TOURNAMENT_DATA?")) {
            ['q1','q2','q3','q4','s1','s2','f1'].forEach(id => document.getElementById(id).value = "");
            localStorage.removeItem('tournament_bracket');
        }
    }

    window.onload = () => {
        refreshUI();
        const b = JSON.parse(localStorage.getItem('tournament_bracket'));
        if(b) Object.keys(b).forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = b[id]; });
        setInterval(checkITStatus, 2000);
    };
</script>
</body>
</html>
